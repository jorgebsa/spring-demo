## Spring demo microservice
![GitHub branch checks state](https://img.shields.io/github/checks-status/jorgebsa/spring-demo/main) [![codecov](https://codecov.io/gh/jorgebsa/spring-demo/branch/main/graph/badge.svg?token=55F3FYDVUN)](https://codecov.io/gh/jorgebsa/spring-demo)

* The purpose of this project is to implement a simple CRUD microservice with Spring Boot showcasing some of the best practices available.
* MongoDB has been chosen as the underlying database.
* Swagger UI is available at `http://localhost:8080/swagger-ui.html`

### Build

* The project is built with gradle, and uses Java language version 17. 
  * If the toolchain for java 17 is not found on your machine, gradle will download it before building.

```shell
./gradlew build
```

### Tests

* Integration tests can be found in the `src/test` directory.
* Instead of using an embedded database, the tests rely on `testcontainers` to launch an actual MongoDB container. Therefore, it is mandatory to have `docker` installed and running in order to run the tests.  
  * This is what would happen in production, so why not run an actual database, right? Usage of Embedded databases can result in unreliable tests, as they don't reproduce the real world environment 
  * The `mongodb` container is stopped and removed once tests are finished
  * If the `mongo` docker image is not available locally, it will be downloaded by the `testscontainers` lib
  * if you want to download it manually you can by running `docker pull mongo:4.0.10`
* Code coverage report is generated by the JaCoCo gradle plugin after test execution, the HTML can be found at `build/reports/jacoco/test/html/index.html`
  * The gradle task`jacocoTestReport` runs after task `test` has finished

In order to run the tests, you can execute:

```shell
./gradlew test
```

### Running the microservice

* Since the microservice depends on a MongoDB instance to be available, a `docker-compose.yml` that spins up a MongoDB container has been added to the project
  * If you have Mongo installed or available on a given URL, you can use that instead, just don't forget to update `src/main/resources/application.yml` with the appropriate connection values

In order to run the database and the service, execute: 

```shell
docker-compose up -d
./gradlew run
```

If tou wish to stop the database, execute:
```shell
docker-compose down
```

### TO DO!!

* Add more MongoDB queries
  * Right now there's only findById and findPage, but there are many queries that can be added in order to filter the results, such as querying by creation date of last modified date in a range for example
* Add more integration tests (++coverage!)
* Add mutation testing, using Pitest
  * This is a great tool that helps implement meaningful tests, not just tests for the sake of line coverage metrics
* Integrate with Spring Security 
  * Use Keycloak as the authorization server
  * Remove hardcoded `username` from controller once `Principal` is available to use
  * Allow delete/update of a note only by its owner or an `ADMIN` 
* Create a docker image for the project
  * Add new image and Keycloak to the project's `docker-compose.yml`
* Improve OpenAPI documentation with annotation usage
* Improve this `README.md`
  * Explain more concepts behind the project
  * Give examples on how to use the endpoints with payloads and responses
  
